<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>å…³äºNginxå¯ç”¨Httpsçš„è®°å½• - hellojxl</title><link rel="icon" type="image/png" href=icons/l.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="å…³äºNginxå¯ç”¨Httpsçš„è®°å½•" />
<meta property="og:description" content="è®°å½•åŸå›  ä¹‹å‰ä¹Ÿéƒ¨ç½²è¿‡ï¼Œç»“æœä¸Šæ¬¡å› ä¸ºä¹°äº†ä¸€ä¸ªæ–°çš„VPSï¼Œæ‰“ç®—éƒ¨ç½²v2rayçš„æ—¶å€™ï¼Œé‡åˆ°ç‚¹é—®é¢˜ï¼Œæ„Ÿè§‰è¿˜æ˜¯è¦è®°å½•ä¸‹æ¥ï¼Œå› ä¸ºæ˜¯è‡ªå·±ç”¨æ‰€ä»¥å°±ç›´æ¥ç”¨Let&#39;s Encryptéƒ¨ç½²å§ï¼Œå› ä¸ºå¯ä»¥è‡ªåŠ¨ç»­æœŸï¼Œ90å¤©ä¹Ÿæ— æ‰€è°“ã€‚
å®‰è£…éƒ¨ç½² å•¥ä¹Ÿä¸è¯´ï¼Œç›´æ¥ä¸Šcertbot,è¯¦ç»†çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œåªè®°å½•ç®€å•çš„éƒ¨ç½²
 å®‰è£…å‰æ
å› ä¸ºcertbotåŸºäºpythonï¼Œæ‰€ä»¥ç³»ç»Ÿéœ€è¦å…ˆå®‰è£…Python 2.7 or 3.4&#43;ä»¥ä¸Šçš„ç‰ˆæœ¬ ä¸‹è½½certbot  # wget https://dl.eff.org/certbot-auto //ä¸‹è½½# chmod a&#43;x ./certbot-auto //ä¿®æ”¹æƒé™# ./certbot-auto --help //éªŒè¯æ˜¯å¦æˆåŠŸ å¼€å§‹éƒ¨ç½²  é¦–å…ˆè¦çœ‹nginxçš„æ ¹ç›®å½•åœ¨ä»€ä¹ˆä½ç½®ï¼Œæœ‰çš„åœ¨/var/www/htmlä¸‹ï¼Œæœ‰çš„åœ¨/usr/share/nginx/htmlä¸‹ã€‚
ç„¶åé…ç½®nginxè¯»å–certbotäº§ç”Ÿçš„æ–‡æœ¬æ–‡ä»¶
location ~ /.well-known/acme-challenge/ {allow	all;root /usr/share/nginx/html;default_type	&#34;text/plain&#34;;}location = /.well-known/acme-challenge/ {return 404;} è¿è¡Œnginx -s reloadé‡æ–°åŠ è½½é…ç½®
./certbot-auto certonly --webroot -w /usr/share/nginx/html/ -d your.domain.com æŒ‡å®šwebrootå’ŒåŸŸåï¼Œåªè¦èƒ½å¤Ÿè®¿é—®å°±æˆåŠŸäº†ï¼Œåˆ‡è®°ä¸€æ¬¡æœ€å¤šäº”æ¬¡ï¼Œå¦åˆ™ä¼šè¢«é™åˆ¶ï¼Œå½“æ—¶å› ä¸ºåœ°å€å¼„é”™äº†ï¼Œç­‰äº†ä¸€ä¸ªæ˜ŸæœŸ&hellip;
å‘æ”¾è¯ä¹¦äº†è¿˜éœ€è¦é…ç½®nginxå¯ç”¨
server {listen	80;server_name	www.domain.com domain.com;return	301	$scheme:https://www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.hellojxl.com/posts/%E5%85%B3%E4%BA%8Enginx%E5%90%AF%E7%94%A8https%E7%9A%84%E8%AE%B0%E5%BD%95/" />
<meta property="article:published_time" content="2018-07-21T22:54:45+00:00" />
<meta property="article:modified_time" content="2018-07-21T22:54:45+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å…³äºNginxå¯ç”¨Httpsçš„è®°å½•"/>
<meta name="twitter:description" content="è®°å½•åŸå›  ä¹‹å‰ä¹Ÿéƒ¨ç½²è¿‡ï¼Œç»“æœä¸Šæ¬¡å› ä¸ºä¹°äº†ä¸€ä¸ªæ–°çš„VPSï¼Œæ‰“ç®—éƒ¨ç½²v2rayçš„æ—¶å€™ï¼Œé‡åˆ°ç‚¹é—®é¢˜ï¼Œæ„Ÿè§‰è¿˜æ˜¯è¦è®°å½•ä¸‹æ¥ï¼Œå› ä¸ºæ˜¯è‡ªå·±ç”¨æ‰€ä»¥å°±ç›´æ¥ç”¨Let&#39;s Encryptéƒ¨ç½²å§ï¼Œå› ä¸ºå¯ä»¥è‡ªåŠ¨ç»­æœŸï¼Œ90å¤©ä¹Ÿæ— æ‰€è°“ã€‚
å®‰è£…éƒ¨ç½² å•¥ä¹Ÿä¸è¯´ï¼Œç›´æ¥ä¸Šcertbot,è¯¦ç»†çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œåªè®°å½•ç®€å•çš„éƒ¨ç½²
 å®‰è£…å‰æ
å› ä¸ºcertbotåŸºäºpythonï¼Œæ‰€ä»¥ç³»ç»Ÿéœ€è¦å…ˆå®‰è£…Python 2.7 or 3.4&#43;ä»¥ä¸Šçš„ç‰ˆæœ¬ ä¸‹è½½certbot  # wget https://dl.eff.org/certbot-auto //ä¸‹è½½# chmod a&#43;x ./certbot-auto //ä¿®æ”¹æƒé™# ./certbot-auto --help //éªŒè¯æ˜¯å¦æˆåŠŸ å¼€å§‹éƒ¨ç½²  é¦–å…ˆè¦çœ‹nginxçš„æ ¹ç›®å½•åœ¨ä»€ä¹ˆä½ç½®ï¼Œæœ‰çš„åœ¨/var/www/htmlä¸‹ï¼Œæœ‰çš„åœ¨/usr/share/nginx/htmlä¸‹ã€‚
ç„¶åé…ç½®nginxè¯»å–certbotäº§ç”Ÿçš„æ–‡æœ¬æ–‡ä»¶
location ~ /.well-known/acme-challenge/ {allow	all;root /usr/share/nginx/html;default_type	&#34;text/plain&#34;;}location = /.well-known/acme-challenge/ {return 404;} è¿è¡Œnginx -s reloadé‡æ–°åŠ è½½é…ç½®
./certbot-auto certonly --webroot -w /usr/share/nginx/html/ -d your.domain.com æŒ‡å®šwebrootå’ŒåŸŸåï¼Œåªè¦èƒ½å¤Ÿè®¿é—®å°±æˆåŠŸäº†ï¼Œåˆ‡è®°ä¸€æ¬¡æœ€å¤šäº”æ¬¡ï¼Œå¦åˆ™ä¼šè¢«é™åˆ¶ï¼Œå½“æ—¶å› ä¸ºåœ°å€å¼„é”™äº†ï¼Œç­‰äº†ä¸€ä¸ªæ˜ŸæœŸ&hellip;
å‘æ”¾è¯ä¹¦äº†è¿˜éœ€è¦é…ç½®nginxå¯ç”¨
server {listen	80;server_name	www.domain.com domain.com;return	301	$scheme:https://www."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://www.hellojxl.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.hellojxl.com/css/main.css" /><link rel="stylesheet" type="text/css" href="https://www.hellojxl.com/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://www.hellojxl.com/js/feather.min.js"></script>
	
	<script src="https://www.hellojxl.com/js/main.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://www.hellojxl.com/">hellojxl</a></h1>
	<div class="site-description"><h2></h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/jxl922/" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/hellojxl" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">é¦–é¡µ</a>
			</li>
			
			<li>
				<a href="/posts">æ‰€æœ‰æ–‡ç« </a>
			</li>
			
			<li>
				<a href="/tags">æ ‡ç­¾</a>
			</li>
			
			<li>
				<a href="/about">å…³äºæˆ‘</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">å…³äºNginxå¯ç”¨Httpsçš„è®°å½•</h1>
			<div class="meta">Posted at &mdash; Jul 21, 2018</div>
		</div>

		<div class="markdown">
			<h4 id="è®°å½•åŸå› ">è®°å½•åŸå› </h4>
<p>ä¹‹å‰ä¹Ÿéƒ¨ç½²è¿‡ï¼Œç»“æœä¸Šæ¬¡å› ä¸ºä¹°äº†ä¸€ä¸ªæ–°çš„VPSï¼Œæ‰“ç®—éƒ¨ç½²<a href="https://www.v2ray.com">v2ray</a>çš„æ—¶å€™ï¼Œé‡åˆ°ç‚¹é—®é¢˜ï¼Œæ„Ÿè§‰è¿˜æ˜¯è¦è®°å½•ä¸‹æ¥ï¼Œå› ä¸ºæ˜¯è‡ªå·±ç”¨æ‰€ä»¥å°±ç›´æ¥ç”¨Let's Encryptéƒ¨ç½²å§ï¼Œå› ä¸ºå¯ä»¥è‡ªåŠ¨ç»­æœŸï¼Œ90å¤©ä¹Ÿæ— æ‰€è°“ã€‚</p>
<h4 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</h4>
<p>å•¥ä¹Ÿä¸è¯´ï¼Œç›´æ¥ä¸Š<a href="https://certbot.eff.org/">certbot</a>,è¯¦ç»†çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œåªè®°å½•ç®€å•çš„éƒ¨ç½²</p>
<ul>
<li>å®‰è£…å‰æ<br>
å› ä¸ºcertbotåŸºäºpythonï¼Œæ‰€ä»¥ç³»ç»Ÿéœ€è¦å…ˆå®‰è£…Python 2.7 or 3.4+ä»¥ä¸Šçš„ç‰ˆæœ¬</li>
<li>ä¸‹è½½certbot</li>
</ul>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># wget https://dl.eff.org/certbot-auto //ä¸‹è½½
# chmod a+x ./certbot-auto  //ä¿®æ”¹æƒé™
# ./certbot-auto --help  //éªŒè¯æ˜¯å¦æˆåŠŸ
</code></pre></div><ul>
<li>å¼€å§‹éƒ¨ç½²</li>
</ul>
<p>é¦–å…ˆè¦çœ‹nginxçš„æ ¹ç›®å½•åœ¨ä»€ä¹ˆä½ç½®ï¼Œæœ‰çš„åœ¨/var/www/htmlä¸‹ï¼Œæœ‰çš„åœ¨/usr/share/nginx/htmlä¸‹ã€‚</p>
<p>ç„¶åé…ç½®nginxè¯»å–certbotäº§ç”Ÿçš„æ–‡æœ¬æ–‡ä»¶</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">location ~ /.well-known/acme-challenge/ {
	allow	all;
	root /usr/share/nginx/html;
	default_type	&#34;text/plain&#34;;
}
location = /.well-known/acme-challenge/ {
	return 404;
} 
</code></pre></div><p>è¿è¡Œnginx -s reloadé‡æ–°åŠ è½½é…ç½®</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">./certbot-auto certonly --webroot -w /usr/share/nginx/html/ -d your.domain.com  
</code></pre></div><p>æŒ‡å®šwebrootå’ŒåŸŸåï¼Œåªè¦èƒ½å¤Ÿè®¿é—®å°±æˆåŠŸäº†ï¼Œåˆ‡è®°ä¸€æ¬¡æœ€å¤šäº”æ¬¡ï¼Œå¦åˆ™ä¼šè¢«é™åˆ¶ï¼Œå½“æ—¶å› ä¸ºåœ°å€å¼„é”™äº†ï¼Œç­‰äº†ä¸€ä¸ªæ˜ŸæœŸ&hellip;</p>
<p>å‘æ”¾è¯ä¹¦äº†è¿˜éœ€è¦é…ç½®nginxå¯ç”¨</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">server {
	listen	80;
	server_name	www.domain.com domain.com;
	return	301	$scheme:https://www.$host$request_uri;
}

server {
    listen       443	ssl http2;
    ssl	on;
    server_name  your.domain.com;
    add_header Strict-Transport-Security &#34;max-age=63072000; includeSubdomains; preload&#34;;
    ssl_certificate	/etc/letsencrypt/live/your.domain.com/fullchain.pem;
    ssl_certificate_key	 /etc/letsencrypt/live/your.domain.com/privkey.pem;
    ssl_trusted_certificate	/etc/letsencrypt/live/your.domain.com/chain.pem;
    ssl_protocols	TLSV1.1	TLSV1.2;
    ssl_prefer_server_ciphers	on;
    ssl_ciphers	AES256+EECDH:AES256+EDH:!aNULL;
}
</code></pre></div><p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç½‘ä¸Šå¥½å¤šé…ç½®çš„ssl_certificateæ˜¯fullchain.pemï¼Œç»“æœæµè§ˆå™¨ä¸Šéƒ½ä¼šæŠ¥ä¸ä¿¡ä»»é”™è¯¯ï¼Œåæ¥å‘ç°åŸæ¥æ˜¯è®¿é—®åœ°å€çš„é—®é¢˜ï¼Œè¿™é‡Œæ¶‰åŠåˆ°è£¸åŸŸçš„é—®é¢˜ï¼Œé»˜è®¤é…ç½®çš„å¯èƒ½æ˜¯www.example.comï¼Œå¦‚æœæˆ‘ç›´æ¥è®¿é—®example.comé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šæŠ¥åŸŸåä¸åŒ¹é…çš„é—®é¢˜ï¼Œå› ä¸ºç­¾åçš„æ—¶å€™æ˜¯å¸¦wwwçš„ï¼Œæ‰€ä»¥éœ€è¦301é‡å®šå‘åˆ°wwwä¸Šå°±å¯ä»¥äº†ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è‡ªåŠ¨ç»­æœŸäº†ï¼Œå¾ˆç®€å•</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">./certbot-auto renew --quiet
</code></pre></div><p>å› ä¸ºæˆ‘æ˜¯åœ¨centos7ä¸Šæ‰§è¡Œçš„ï¼Œä¸åŒçš„ç³»ç»Ÿå‘½ä»¤å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œç²¾åŠ›æœ‰é™æ²¡åŠæ³•ä¸€ä¸€æµ‹è¯•ï¼Œä¸€å®šè¦æ³¨æ„ã€‚</p>
<h4 id="ç»“å°¾">ç»“å°¾</h4>
<p>éƒ¨ç½²å®Œä¹‹åå¯ä»¥ç”¨<a href="https://www.ssllabs.com/ssltest/">SSL Labs</a>æœåŠ¡è¿›è¡Œæµ‹è¯•çœ‹çœ‹å¾—å¤šå°‘åˆ†ï¼Œä¹ŸæŒºå¥½ç©çš„ğŸ˜„ï¼Œä¹‹å‰çŸ¥é“git pagesä¹Ÿå¯ç”¨httpsä¹‹åï¼Œä¸€ç›´æƒ³å¯ç”¨ï¼Œç»“æœå‘ç°è…¾è®¯çš„dnsè®°å½•åªèƒ½æ·»åŠ ä¸‰æ¡ï¼Œå†å¤šå°±å¾—åŠ é’±ï¼Œå¿«åˆ°æœŸçš„æ—¶å€™ä¸€å®šè¦è¿å‡ºå»ï¼Œç›®å‰æ‰“ç®—è¿åˆ°namesiloï¼Œå›½å†…çœŸæ˜¯å„ç§å—é™ğŸ˜–</p>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/nginx">Nginx</a></li>
								
								<li><a href="/tags/lets-encrypt">Let&#39;s Encrypt</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Â© Copyright hellojxl |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-155998474-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>

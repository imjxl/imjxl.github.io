<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>å…³äºHangfireçš„ç”¨æ³• - hellojxl</title><link rel="icon" type="image/png" href=icons/l.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="å…³äºHangfireçš„ç”¨æ³•" />
<meta property="og:description" content="æœ€è¿‘é¡¹ç›®ä¸­è¦æ‰§è¡Œåå°ä»»åŠ¡ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ä¸‹ç›¸å…³åº“ï¼Œåˆšå¼€å§‹ç”¨çš„æ˜¯TimedJobï¼Œç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæœ¬èº«æä¾›ä¾èµ–æ³¨å…¥,ä»£ç å¦‚ä¸‹ï¼š
//å…ˆåœ¨ConfigureServicesæ·»åŠ app.AddTimedJob(); //ç„¶ååœ¨Configureä¸­ä½¿ç”¨app.UseTimedJob();//å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿æ¥å£Jobpublic Class MyJob:Job{private IConfigure _configure;//æ³¨å…¥é…ç½®æ–‡ä»¶public MyJob(IConfigure configure){_configure=configure;}[Invoke(Begin = &#34;2018-11-29 23:00:00&#34;, Interval = 1000 * 3600 * 24, SkipWhileExecuting =true)]public void Run(){//Jobè¦æ‰§è¡Œçš„é€»è¾‘ä»£ç Console.WriteLine(&#34;hello world&#34;);}} æ•´ä¸ªç”¨æ³•è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå¦‚æœåªæ˜¯ä¸€äº›ç®€å•ä»»åŠ¡å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåªæ˜¯å¦‚æœæƒ³é€šè¿‡UIæ§åˆ¶çš„è¯ï¼Œè¿™ç§æ–¹å¼åšçš„å·¥ä½œæœ‰ç‚¹å¤šï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±è¦è¯´åˆ°Hangfireäº†,è¿™ä¸ªç”¨èµ·æ¥å°±æ›´ç®€å•äº†ï¼Œè€Œä¸”è‡ªå¸¦UIï¼Œå¯ä»¥ç›´æ¥åœ¨UIä¸Šè¿›è¡Œä»»åŠ¡è§¦å‘ï¼Œç”¨æ³•è·ŸTimedJobå·®ä¸å¤šï¼ŒåŒæ—¶ç”±äºHangfireéœ€è¦ä¿å­˜ä»»åŠ¡ï¼Œéœ€è¦æ•°æ®åº“æ”¯æŒï¼Œç¬¬ä¸‰æ–¹æ’ä»¶ä¹Ÿæ”¯æŒRedisï¼Œç”±äºé¡¹ç›®æ­£å¥½ç”¨Sql Serverï¼Œå†åŠ ä¸Šä»»åŠ¡ä¸æ˜¯å¾ˆå¤æ‚å°±ç›´æ¥ç”¨æ•°æ®åº“äº†
//æ·»åŠ Hangfireï¼Œæ­¤å¤„ç”¨çš„æ˜¯PostgreSqlservices.AddHangfire(config=&gt;{config.UsePostgreSqlStorage(&#34;ConnectionString&#34;);}); //ä½¿ç”¨Hangfireapp.UseHangfireServer();//è‡ªå®šä¹‰è®¤è¯ï¼Œé»˜è®¤åªèƒ½æœ¬åœ°DashboardOptions options=new DashboardOptions();options.Authorization=new []{new MyAuthorization()};app.UseHangfireDashboard(&#34;/Job&#34;,options);//æ·»åŠ ä»»åŠ¡RecurringJob.AddOrUpdate(&#34;MyJob&#34;,x=&gt;x.HelloTest(&#34;Hello World&#34;),Cron.Minutely);è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ä¸€ä¸‹
 ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸ªé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°  //å…ˆå®šä¹‰æ¥å£public interface IGoodJob{void HelloTest(string test);}//å®ç°æ¥å£public class MyJob : IGoodJob{private IConfiguration _configure;public MyJob(IConfiguration Configuration){_configure=Configuration;}public void HelloTest(string test){Console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.hellojxl.com/posts/%E5%85%B3%E4%BA%8Ehangfire%E7%9A%84%E7%94%A8%E6%B3%95/" />
<meta property="article:published_time" content="2018-06-28T21:56:14+00:00" />
<meta property="article:modified_time" content="2018-06-28T21:56:14+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å…³äºHangfireçš„ç”¨æ³•"/>
<meta name="twitter:description" content="æœ€è¿‘é¡¹ç›®ä¸­è¦æ‰§è¡Œåå°ä»»åŠ¡ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ä¸‹ç›¸å…³åº“ï¼Œåˆšå¼€å§‹ç”¨çš„æ˜¯TimedJobï¼Œç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæœ¬èº«æä¾›ä¾èµ–æ³¨å…¥,ä»£ç å¦‚ä¸‹ï¼š
//å…ˆåœ¨ConfigureServicesæ·»åŠ app.AddTimedJob(); //ç„¶ååœ¨Configureä¸­ä½¿ç”¨app.UseTimedJob();//å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿æ¥å£Jobpublic Class MyJob:Job{private IConfigure _configure;//æ³¨å…¥é…ç½®æ–‡ä»¶public MyJob(IConfigure configure){_configure=configure;}[Invoke(Begin = &#34;2018-11-29 23:00:00&#34;, Interval = 1000 * 3600 * 24, SkipWhileExecuting =true)]public void Run(){//Jobè¦æ‰§è¡Œçš„é€»è¾‘ä»£ç Console.WriteLine(&#34;hello world&#34;);}} æ•´ä¸ªç”¨æ³•è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå¦‚æœåªæ˜¯ä¸€äº›ç®€å•ä»»åŠ¡å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåªæ˜¯å¦‚æœæƒ³é€šè¿‡UIæ§åˆ¶çš„è¯ï¼Œè¿™ç§æ–¹å¼åšçš„å·¥ä½œæœ‰ç‚¹å¤šï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±è¦è¯´åˆ°Hangfireäº†,è¿™ä¸ªç”¨èµ·æ¥å°±æ›´ç®€å•äº†ï¼Œè€Œä¸”è‡ªå¸¦UIï¼Œå¯ä»¥ç›´æ¥åœ¨UIä¸Šè¿›è¡Œä»»åŠ¡è§¦å‘ï¼Œç”¨æ³•è·ŸTimedJobå·®ä¸å¤šï¼ŒåŒæ—¶ç”±äºHangfireéœ€è¦ä¿å­˜ä»»åŠ¡ï¼Œéœ€è¦æ•°æ®åº“æ”¯æŒï¼Œç¬¬ä¸‰æ–¹æ’ä»¶ä¹Ÿæ”¯æŒRedisï¼Œç”±äºé¡¹ç›®æ­£å¥½ç”¨Sql Serverï¼Œå†åŠ ä¸Šä»»åŠ¡ä¸æ˜¯å¾ˆå¤æ‚å°±ç›´æ¥ç”¨æ•°æ®åº“äº†
//æ·»åŠ Hangfireï¼Œæ­¤å¤„ç”¨çš„æ˜¯PostgreSqlservices.AddHangfire(config=&gt;{config.UsePostgreSqlStorage(&#34;ConnectionString&#34;);}); //ä½¿ç”¨Hangfireapp.UseHangfireServer();//è‡ªå®šä¹‰è®¤è¯ï¼Œé»˜è®¤åªèƒ½æœ¬åœ°DashboardOptions options=new DashboardOptions();options.Authorization=new []{new MyAuthorization()};app.UseHangfireDashboard(&#34;/Job&#34;,options);//æ·»åŠ ä»»åŠ¡RecurringJob.AddOrUpdate(&#34;MyJob&#34;,x=&gt;x.HelloTest(&#34;Hello World&#34;),Cron.Minutely);è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ä¸€ä¸‹
 ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸ªé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°  //å…ˆå®šä¹‰æ¥å£public interface IGoodJob{void HelloTest(string test);}//å®ç°æ¥å£public class MyJob : IGoodJob{private IConfiguration _configure;public MyJob(IConfiguration Configuration){_configure=Configuration;}public void HelloTest(string test){Console."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://www.hellojxl.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.hellojxl.com/css/main.css" /><link rel="stylesheet" type="text/css" href="https://www.hellojxl.com/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://www.hellojxl.com/js/feather.min.js"></script>
	
	<script src="https://www.hellojxl.com/js/main.js"></script>
	<script src="https://www.hellojxl.com/js/jquery-3.4.1.min.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://www.hellojxl.com/">hellojxl</a></h1>
	<div class="site-description"><h2></h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/jxl922/" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/hellojxl" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">é¦–é¡µ</a>
			</li>
			
			<li>
				<a href="/posts">æ‰€æœ‰æ–‡ç« </a>
			</li>
			
			<li>
				<a href="/tags">æ ‡ç­¾</a>
			</li>
			
			<li>
				<a href="/about">å…³äºæˆ‘</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">å…³äºHangfireçš„ç”¨æ³•</h1>
			<div class="meta">Posted at &mdash; Jun 28, 2018</div>
		</div>

		<div class="markdown">
			<p>æœ€è¿‘é¡¹ç›®ä¸­è¦æ‰§è¡Œåå°ä»»åŠ¡ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ä¸‹ç›¸å…³åº“ï¼Œåˆšå¼€å§‹ç”¨çš„æ˜¯<a href="https://www.nuget.org/packages/Pomelo.AspNetCore.TimedJob/2.0.0-rtm-10046">TimedJob</a>ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæœ¬èº«æä¾›ä¾èµ–æ³¨å…¥,ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">
//å…ˆåœ¨ConfigureServicesæ·»åŠ 
app.AddTimedJob();  
//ç„¶ååœ¨Configureä¸­ä½¿ç”¨
app.UseTimedJob();
//å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿æ¥å£Job
public Class MyJob:Job
{
	private IConfigure _configure;
	//æ³¨å…¥é…ç½®æ–‡ä»¶
	public MyJob(IConfigure configure)
	{
		_configure=configure;
	}
	[Invoke(Begin = &#34;2018-11-29 23:00:00&#34;, Interval = 1000 * 3600 * 24, SkipWhileExecuting =true)]
     public void Run()
     {
          //Jobè¦æ‰§è¡Œçš„é€»è¾‘ä»£ç 
          Console.WriteLine(&#34;hello world&#34;);
     }
}  

</code></pre></div><p>æ•´ä¸ªç”¨æ³•è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå¦‚æœåªæ˜¯ä¸€äº›ç®€å•ä»»åŠ¡å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåªæ˜¯å¦‚æœæƒ³é€šè¿‡UIæ§åˆ¶çš„è¯ï¼Œè¿™ç§æ–¹å¼åšçš„å·¥ä½œæœ‰ç‚¹å¤šï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±è¦è¯´åˆ°<a href="https://www.hangfire.io">Hangfire</a>äº†,è¿™ä¸ªç”¨èµ·æ¥å°±æ›´ç®€å•äº†ï¼Œè€Œä¸”è‡ªå¸¦UIï¼Œå¯ä»¥ç›´æ¥åœ¨UIä¸Šè¿›è¡Œä»»åŠ¡è§¦å‘ï¼Œç”¨æ³•è·ŸTimedJobå·®ä¸å¤šï¼ŒåŒæ—¶ç”±äºHangfireéœ€è¦ä¿å­˜ä»»åŠ¡ï¼Œéœ€è¦æ•°æ®åº“æ”¯æŒï¼Œç¬¬ä¸‰æ–¹æ’ä»¶ä¹Ÿæ”¯æŒRedisï¼Œç”±äºé¡¹ç›®æ­£å¥½ç”¨Sql Serverï¼Œå†åŠ ä¸Šä»»åŠ¡ä¸æ˜¯å¾ˆå¤æ‚å°±ç›´æ¥ç”¨æ•°æ®åº“äº†</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">
//æ·»åŠ Hangfireï¼Œæ­¤å¤„ç”¨çš„æ˜¯PostgreSql
services.AddHangfire(
	config=&gt;{
	config.UsePostgreSqlStorage(&#34;ConnectionString&#34;);
 });  
 //ä½¿ç”¨Hangfire
 app.UseHangfireServer();
 //è‡ªå®šä¹‰è®¤è¯ï¼Œé»˜è®¤åªèƒ½æœ¬åœ°
 DashboardOptions options=new DashboardOptions();
 options.Authorization=new []{new MyAuthorization()};
 app.UseHangfireDashboard(&#34;/Job&#34;,options);
 
 //æ·»åŠ ä»»åŠ¡
RecurringJob.AddOrUpdate(&#34;MyJob&#34;,x=&gt;x.HelloTest(&#34;Hello World&#34;),Cron.Minutely);
</code></pre></div><p>è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ä¸€ä¸‹</p>
<ul>
<li>ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸ªé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°</li>
</ul>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">//å…ˆå®šä¹‰æ¥å£
public interface IGoodJob
{
    void HelloTest(string test);
}
//å®ç°æ¥å£
public class MyJob : IGoodJob
{
    private IConfiguration _configure;
    public MyJob(IConfiguration Configuration)
    {
         _configure=Configuration;
    }
    public void HelloTest(string test)
    {
        Console.WriteLine(&#34;hello&#34;+test);
    }
}
//åœ¨ConfigureServicesä¸­æ³¨å†Œ
services.AddSingleton&lt;IGoodJob,MyJob&gt;();
//åœ¨æœ€åè°ƒç”¨
RecurringJob.AddOrUpdate&lt;IGoodJob&gt;(&#34;Job&#34;,x=&gt;x.HelloTest(&#34;good&#34;),Cron.Minutely);
</code></pre></div><ul>
<li>è‡ªå®šä¹‰è®¤è¯ï¼Œç”±äºå½“å‰é¡¹ç›®ç”¨çš„æ˜¯JWTè®¤è¯ï¼Œå½“æ—¶å‚è€ƒäº†<a href="https://discuss.hangfire.io/t/using-bearer-auth-token/2166/3">è¿™é‡Œ</a>,å°±æ˜¯Hangfireçš„è®ºå›ï¼Œç”±äºå¢åŠ è®¤è¯ä¹‹åï¼Œæ¯æ¬¡é¢æ¿åˆ·æ–°æ•°æ®éƒ½ä¼šè¿›è¡Œè®¤è¯ï¼Œæ‰€ä»¥ä»¿ç…§è¿™ä¸ªåœ°å€å°†Tokenæ”¾åˆ°Cookieé‡Œï¼Œæ¯æ¬¡éªŒè¯çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹ï¼Œè€Œä¸”è¿˜è¦åˆ¤æ–­tokenæ˜¯å¦è¿‡æœŸï¼Œä»£ç å…ˆä¸è´´äº†ï¼Œéœ€è¦éªŒè¯</li>
</ul>
<h4 id="æœ€å">æœ€å</h4>
<p>å…¶å®ä¸åªè¿™ä¸¤ä¸ªï¼Œè¿™é‡Œåªæ˜¯æŠŠè‡ªå·±ç”¨åˆ°çš„è®°å½•ä¸€ä¸‹ï¼Œå…¶ä»–çš„è¿˜æœ‰Quartz.NETï¼ŒFluentSchedulerç­‰ï¼Œä»Šå¤©çœ‹å…¬ä¼—å·å‘ç°2.1é‡Œé¢ä¹Ÿè‡ªå¸¦äº†IHostedServiceæ¥å£ï¼Œå…·ä½“ç”¨æ³•è¿˜æ˜¯å‚è€ƒå®˜æ–¹æ–‡æ¡£å§ï¼Œå¥½äº†ï¼Œæ´—æ¼±ç¡è§‰äº†ğŸ˜ª</p>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/dotnet-core">dotnet core</a></li>
								
								<li><a href="/tags/c">c#</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Â© Copyright hellojxl |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-155998474-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
